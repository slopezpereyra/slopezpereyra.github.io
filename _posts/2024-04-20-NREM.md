---
title: An application of formal language theory to the detection of NREM sleep
categories: [ Science ]
---

# Introduction

I here provide an algorithm to automatically detect NREM periods given a
sequence of sleep stages. 


Given sleep stages $s_1, \ldots, s_n$, where $s_i$ the sleep stage of the $i$th
epoch of sleep, we wish to produce a sequence of $k$ vectors $\varrho_1,
\ldots, \varrho_k$. Such vectors must be s.t. each $\varrho_i = (\varrho_i^1,
\ldots, \varrho_i^z)$ satisfies that $\varrho_{i}^{j}$ is the $j$th epoch in
the $i$th NREM period. 

The sleep stage of an (usually $30$-second) epoch is typically done by trained
humans via direct inspection of the full-night EEG. A NREM period is defined as
any sequence of epochs satisfying the following conditions:

- the sequence contains NREM stages (stages $2$, $3$ or $4$) not interrupted by
more than $5$ minutes of other periods.
- the total amount of NREM sleep in the sequence is $15$ minutes or more;
- the sequence is ended by either $a.$ 5 minutes or more of REM or $b.$ $5$
minutes or more of wakefulness. 


Importantly, when parsing for a NREM period, the sequence may contain stages
that aren't NREM stages. But these should be ignored unless they last for five
minutes or more-i.e. unless they qualify as potential ending sequences for a
NREM period. (If curious about where this definition comes from, see [Feinberg
& Floyed](https://pubmed.ncbi.nlm.nih.gov/220659/) or study Dijk's papers.)

------

# The algorithm

We define a sleep stage as an element of the alphabet $\Sigma = \{ 1, \ldots, 6
\right\}$. For the moment, let $n, m \in \mathbb{N}$ be parameters in our algorithm.
Their purpose will become clear later.

Let $\mathcal{L} = [(5+6)^* (2+3+4)^* ]^* \subseteq \Sigma^*$. Define
$\mathcal{L}'\subseteq \mathcal{L}$ as the set of words containing at least $n$
symbols in $\{ 2, 3, 4 \}$ and s.t. no other symbols occur repeatedly $w$ or
more times. It is clear that $\mathcal{L} = \mathcal{L}' \cup
\overline{\mathcal{L}'}$; i.e. $\mathcal{L}'$ induces a partition of
$\mathcal{L}$.

Then $\alpha = s_1 \ldots s_r$ can be subjected to the following decomposition:

$$\alpha = \psi_1 \phi_1 \psi_2 \phi_2 \ldots \psi_k \phi_k \psi_{k+1}$$

where $\phi_i = \varphi_i (5^m5^* + 6^m6^*)$ and $\varphi_i \in \mathcal{L}$.
Such a decomposition readily provides the number of NREM periods in the EEG
(i.e. $k$).  

This decomposition of $\alpha$ inspires the following effective procedure:


- In $s$, replace the occurrences of $1$ with $0$ and the occurrences 
        of $2, 3, 4$ with $1$.
- Let $\omega_1, \ldots, \omega_r$ be the sub-words of $s$ which
        consist of repeated symbols.
- For each $\omega_1, \ldots, \omega_r$, if $0$ or $1$ occur 
        in $\omega$ do nothing; if $|\omega| \geq m$ do nothing; 
        otherwise, replace $\omega$ with $0^{|\omega|}$.
- Output $\omega := \omega_1 \ldots \omega_r$

An example of each step of this procedure with $m = 3$ over the word
$123331166555$ is

$$
    123331166555 \to 011110066555 \to 0 ~ 1111~ 00 ~ 66~ 555 \to 0 ~1111~ 00~ 00~ 555
$$

and the output would be $011110000555$. Hopefully, we see how the
transformation reveals important information about NREM sleep, insofar as the
$1$s correspond to periods of NREM stages, the $0$s to stages which should be
ignored, and sequences of $5$ or $6$ (of length $\geq m$) to sequences which
mark the end of a NREM period.

It is trivial to observe that the transformation $g$ is $O(n)$, since it can be
done with a a series of iterations over the characters of $s_1 \ldots s_r$.







